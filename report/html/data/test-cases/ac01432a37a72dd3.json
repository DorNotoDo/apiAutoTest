{
  "uid" : "ac01432a37a72dd3",
  "name" : "本地测试上传多文件接口",
  "fullName" : "test.test_api.TestApiAuto#test_main[case_009-本地测试上传多文件接口-upload_files/--post-data-{\"files\":",
  "historyId" : "14463b871c106c316436f73567db2180",
  "time" : {
    "start" : 1605868886328,
    "stop" : 1605868886334,
    "duration" : 6
  },
  "status" : "broken",
  "statusMessage" : "OSError: [Errno 22] Invalid argument: 'D:\\\\\\x07piAutoTest\\\\data\\\\case_data - 副本.xls'",
  "statusTrace" : "self = <test.test_api.TestApiAuto object at 0x000001CF14427548>\ncase_number = 'case_009', case_title = '本地测试上传多文件接口', path = 'upload_files/'\nis_token = '', method = 'post', parametric_key = 'data'\nfile_var = '{\"files\":[\"D:\\\\apiAutoTest\\\\data\\\\case_data - 副本.xls\", \"D:\\\\apiAutoTest\\\\data\\\\case_data.xlsx\"]}'\ndata = None, expect = '{\"msg\": \"ok\"}'\n\n    @pytest.mark.parametrize('case_number,case_title,path,is_token,method,parametric_key,file_var,'\n                             'data,expect', data_list)\n    def test_main(self, case_number, case_title, path, is_token, method, parametric_key, file_var,\n                data, expect):\n    \n        # 感谢：https://www.cnblogs.com/yoyoketang/p/13386145.html，提供动态添加标题的实例代码\n        # 动态添加标题\n        allure.dynamic.title(case_title)\n    \n        logger.debug(f'⬇️⬇️⬇️...执行用例编号:{case_number}...⬇️⬇️⬇️️')\n        with allure.step(\"处理相关数据依赖，header\"):\n    \n            header = DataProcess.header\n            allure.attach(json.dumps(header, ensure_ascii=False, indent=4), \"请求头\", allure.attachment_type.TEXT)\n            path = DataProcess.handle_path(path)\n    \n            data = DataProcess.handle_data(data)\n            allure.attach(json.dumps(data, ensure_ascii=False, indent=4), \"请求数据\", allure.attachment_type.TEXT)\n    \n        with allure.step(\"发送请求，取得响应结果的json串\"):\n            allure.attach(json.dumps(base_url + path, ensure_ascii=False, indent=4), \"最终请求地址\", allure.attachment_type.TEXT)\n            res = br.api_send(method=method, url=base_url + path, parametric_key=parametric_key, file_obj=file_var,\n>                                  data=data, header=header)\n\ntest_api.py:74: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n..\\api\\base_requests.py:42: in api_send\n    files = DataProcess.handler_files(file_obj)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\ncls = <class 'tools.data_process.DataProcess'>\nfile_obj = {'files': ['D:\\x07piAutoTest\\\\data\\\\case_data - 副本.xls', 'D:\\x07piAutoTest\\\\data\\\\case_data.xlsx']}\n\n    @classmethod\n    def handler_files(cls, file_obj: str) -> object:\n        \"\"\"file对象处理方法\n        :param file_obj: 上传文件使用，格式：{\"接口中文件参数的名称\":\"文件路径地址\"/[\"文件地址1\", \"文件地址2\"]}\n        实例- 单个文件: &file&D:\n        \"\"\"\n    \n        # if (file_var in [None, '']) and (file_path in [None, '']):\n        #     files = None\n        # else:\n        #     # 文件不为空的操作\n        #     if file_path.startswith('[') and file_path.endswith(']'):\n        #         file_path_list = eval(file_path)\n        #         files = []\n        #         # 多文件上传\n        #         for file_path in file_path_list:\n        #             files.append((file_var, (open(file_path, 'rb'))))\n        #     else:\n        #         # 单文件上传\n        #         files = {file_var: open(file_path, 'rb')}\n        if file_obj != '' or file_obj != '{}':\n            logger.error(file_obj)\n            file_obj = convert_json(file_obj)\n            files = []\n            for k, v in file_obj.items():\n                if isinstance(v, list):\n                    logger.info('list类型')\n                    for file_path in v:\n                        # 根据系统路径处理文件地址出现的错误转以字符\n                        if file_path[0] != '/':\n                            file_path = file_path.replace(':', ':\\\\')\n                        logger.info(v)\n                        logger.info(file_path)\n>                       files.append((k, (open(file_path, 'rb'))))\nE                       OSError: [Errno 22] Invalid argument: 'D:\\\\\\x07piAutoTest\\\\data\\\\case_data - 副本.xls'\n\n..\\tools\\data_process.py:87: OSError",
  "flaky" : false,
  "newFailed" : false,
  "beforeStages" : [ ],
  "testStage" : {
    "status" : "broken",
    "statusMessage" : "OSError: [Errno 22] Invalid argument: 'D:\\\\\\x07piAutoTest\\\\data\\\\case_data - 副本.xls'",
    "statusTrace" : "self = <test.test_api.TestApiAuto object at 0x000001CF14427548>\ncase_number = 'case_009', case_title = '本地测试上传多文件接口', path = 'upload_files/'\nis_token = '', method = 'post', parametric_key = 'data'\nfile_var = '{\"files\":[\"D:\\\\apiAutoTest\\\\data\\\\case_data - 副本.xls\", \"D:\\\\apiAutoTest\\\\data\\\\case_data.xlsx\"]}'\ndata = None, expect = '{\"msg\": \"ok\"}'\n\n    @pytest.mark.parametrize('case_number,case_title,path,is_token,method,parametric_key,file_var,'\n                             'data,expect', data_list)\n    def test_main(self, case_number, case_title, path, is_token, method, parametric_key, file_var,\n                data, expect):\n    \n        # 感谢：https://www.cnblogs.com/yoyoketang/p/13386145.html，提供动态添加标题的实例代码\n        # 动态添加标题\n        allure.dynamic.title(case_title)\n    \n        logger.debug(f'⬇️⬇️⬇️...执行用例编号:{case_number}...⬇️⬇️⬇️️')\n        with allure.step(\"处理相关数据依赖，header\"):\n    \n            header = DataProcess.header\n            allure.attach(json.dumps(header, ensure_ascii=False, indent=4), \"请求头\", allure.attachment_type.TEXT)\n            path = DataProcess.handle_path(path)\n    \n            data = DataProcess.handle_data(data)\n            allure.attach(json.dumps(data, ensure_ascii=False, indent=4), \"请求数据\", allure.attachment_type.TEXT)\n    \n        with allure.step(\"发送请求，取得响应结果的json串\"):\n            allure.attach(json.dumps(base_url + path, ensure_ascii=False, indent=4), \"最终请求地址\", allure.attachment_type.TEXT)\n            res = br.api_send(method=method, url=base_url + path, parametric_key=parametric_key, file_obj=file_var,\n>                                  data=data, header=header)\n\ntest_api.py:74: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n..\\api\\base_requests.py:42: in api_send\n    files = DataProcess.handler_files(file_obj)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\ncls = <class 'tools.data_process.DataProcess'>\nfile_obj = {'files': ['D:\\x07piAutoTest\\\\data\\\\case_data - 副本.xls', 'D:\\x07piAutoTest\\\\data\\\\case_data.xlsx']}\n\n    @classmethod\n    def handler_files(cls, file_obj: str) -> object:\n        \"\"\"file对象处理方法\n        :param file_obj: 上传文件使用，格式：{\"接口中文件参数的名称\":\"文件路径地址\"/[\"文件地址1\", \"文件地址2\"]}\n        实例- 单个文件: &file&D:\n        \"\"\"\n    \n        # if (file_var in [None, '']) and (file_path in [None, '']):\n        #     files = None\n        # else:\n        #     # 文件不为空的操作\n        #     if file_path.startswith('[') and file_path.endswith(']'):\n        #         file_path_list = eval(file_path)\n        #         files = []\n        #         # 多文件上传\n        #         for file_path in file_path_list:\n        #             files.append((file_var, (open(file_path, 'rb'))))\n        #     else:\n        #         # 单文件上传\n        #         files = {file_var: open(file_path, 'rb')}\n        if file_obj != '' or file_obj != '{}':\n            logger.error(file_obj)\n            file_obj = convert_json(file_obj)\n            files = []\n            for k, v in file_obj.items():\n                if isinstance(v, list):\n                    logger.info('list类型')\n                    for file_path in v:\n                        # 根据系统路径处理文件地址出现的错误转以字符\n                        if file_path[0] != '/':\n                            file_path = file_path.replace(':', ':\\\\')\n                        logger.info(v)\n                        logger.info(file_path)\n>                       files.append((k, (open(file_path, 'rb'))))\nE                       OSError: [Errno 22] Invalid argument: 'D:\\\\\\x07piAutoTest\\\\data\\\\case_data - 副本.xls'\n\n..\\tools\\data_process.py:87: OSError",
    "steps" : [ {
      "name" : "处理相关数据依赖，header",
      "time" : {
        "start" : 1605868886329,
        "stop" : 1605868886330,
        "duration" : 1
      },
      "status" : "passed",
      "steps" : [ ],
      "attachments" : [ {
        "uid" : "4c301cd924afcf19",
        "name" : "请求头",
        "source" : "4c301cd924afcf19.txt",
        "type" : "text/plain",
        "size" : 2
      }, {
        "uid" : "e1972dfb9482faa9",
        "name" : "请求数据",
        "source" : "e1972dfb9482faa9.txt",
        "type" : "text/plain",
        "size" : 4
      } ],
      "parameters" : [ ],
      "stepsCount" : 0,
      "hasContent" : true,
      "attachmentsCount" : 2,
      "shouldDisplayMessage" : false
    }, {
      "name" : "发送请求，取得响应结果的json串",
      "time" : {
        "start" : 1605868886331,
        "stop" : 1605868886333,
        "duration" : 2
      },
      "status" : "broken",
      "statusMessage" : "OSError: [Errno 22] Invalid argument: 'D:\\\\\\x07piAutoTest\\\\data\\\\case_data - 副本.xls'\n",
      "statusTrace" : "  File \"D:\\apiAutoTest\\test\\test_api.py\", line 74, in test_main\n    data=data, header=header)\n  File \"D:\\apiAutoTest\\api\\base_requests.py\", line 42, in api_send\n    files = DataProcess.handler_files(file_obj)\n  File \"D:\\apiAutoTest\\tools\\data_process.py\", line 87, in handler_files\n    files.append((k, (open(file_path, 'rb'))))\n",
      "steps" : [ ],
      "attachments" : [ {
        "uid" : "c6400563e0781fd7",
        "name" : "最终请求地址",
        "source" : "c6400563e0781fd7.txt",
        "type" : "text/plain",
        "size" : 36
      } ],
      "parameters" : [ ],
      "stepsCount" : 0,
      "hasContent" : true,
      "attachmentsCount" : 1,
      "shouldDisplayMessage" : true
    } ],
    "attachments" : [ {
      "uid" : "84d77eba139912af",
      "name" : "stderr",
      "source" : "84d77eba139912af.txt",
      "type" : "text/plain",
      "size" : 1329
    } ],
    "parameters" : [ ],
    "stepsCount" : 2,
    "hasContent" : true,
    "attachmentsCount" : 4,
    "shouldDisplayMessage" : true
  },
  "afterStages" : [ ],
  "labels" : [ {
    "name" : "parentSuite",
    "value" : "test"
  }, {
    "name" : "suite",
    "value" : "test_api"
  }, {
    "name" : "subSuite",
    "value" : "TestApiAuto"
  }, {
    "name" : "host",
    "value" : "LAPTOP-FR8LEA9G"
  }, {
    "name" : "thread",
    "value" : "4248-MainThread"
  }, {
    "name" : "framework",
    "value" : "pytest"
  }, {
    "name" : "language",
    "value" : "cpython3"
  }, {
    "name" : "package",
    "value" : "test.test_api"
  }, {
    "name" : "resultFormat",
    "value" : "allure2"
  } ],
  "parameters" : [ {
    "name" : "case_number",
    "value" : "'case_009'"
  }, {
    "name" : "case_title",
    "value" : "'本地测试上传多文件接口'"
  }, {
    "name" : "data",
    "value" : "''"
  }, {
    "name" : "expect",
    "value" : "'{\"msg\": \"ok\"}'"
  }, {
    "name" : "file_var",
    "value" : "'{\"files\":[\"D:\\apiAutoTest\\data\\case_data - 副本.xls\", \"D:\\apiAutoTest\\data\\case_data.xlsx\"]}'"
  }, {
    "name" : "is_token",
    "value" : "''"
  }, {
    "name" : "method",
    "value" : "'post'"
  }, {
    "name" : "parametric_key",
    "value" : "'data'"
  }, {
    "name" : "path",
    "value" : "'upload_files/'"
  } ],
  "links" : [ ],
  "hidden" : false,
  "retry" : false,
  "extra" : {
    "severity" : "normal",
    "retries" : [ ],
    "categories" : [ {
      "name" : "Test defects",
      "matchedStatuses" : [ ],
      "flaky" : false
    } ],
    "tags" : [ ]
  },
  "source" : "ac01432a37a72dd3.json",
  "parameterValues" : [ "'case_009'", "'本地测试上传多文件接口'", "''", "'{\"msg\": \"ok\"}'", "'{\"files\":[\"D:\\apiAutoTest\\data\\case_data - 副本.xls\", \"D:\\apiAutoTest\\data\\case_data.xlsx\"]}'", "''", "'post'", "'data'", "'upload_files/'" ]
}